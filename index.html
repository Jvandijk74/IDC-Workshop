<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IDC Team Workshop â€” Product Owner Facilitation Tool</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    /* Smooth progress bar animation */
    .transition-width { transition: width 0.5s ease; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50">
  <!-- Header -->
  <div class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">IDC Team Workshop</h1>
          <p class="text-gray-600 mt-1">Product Owner Facilitation Tool</p>
        </div>
        <div class="flex gap-3">
          <button id="btn-day-1" type="button"
            class="px-6 py-2 rounded-lg font-medium transition-all bg-purple-600 text-white shadow-lg">
            Day 1
          </button>
          <button id="btn-day-2" type="button"
            class="px-6 py-2 rounded-lg font-medium transition-all bg-gray-100 text-gray-700 hover:bg-gray-200">
            Day 2
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-6 py-8">
    <!-- Timer Widget -->
    <div id="timer-widget" class="mb-6 bg-white rounded-2xl shadow-lg p-6 border-2 border-purple-200 hidden">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <i data-lucide="clock" class="w-8 h-8 text-purple-600"></i>
          <div>
            <p class="text-sm text-gray-600">Active Timer</p>
            <p id="timer-display" class="text-4xl font-bold text-purple-600">0:00</p>
          </div>
        </div>
        <div class="flex gap-2">
          <button id="timer-toggle" type="button"
            class="p-3 bg-purple-100 hover:bg-purple-200 rounded-lg transition-colors">
            <i data-lucide="pause" class="w-6 h-6 text-purple-600"></i>
          </button>
          <button id="timer-clear" type="button"
            class="p-3 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
            <i data-lucide="rotate-ccw" class="w-6 h-6 text-gray-600"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="mb-8 bg-white rounded-2xl shadow-sm p-6">
      <div class="flex items-center justify-between mb-3">
        <p id="progress-title" class="text-sm font-medium text-gray-700">Day 1 Progress</p>
        <p id="progress-count" class="text-sm text-gray-600">0 / 0 completed</p>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-3">
        <div id="progress-bar"
             class="bg-gradient-to-r from-purple-600 to-pink-600 h-3 rounded-full transition-width"
             style="width: 0%"></div>
      </div>
    </div>

    <!-- Activities -->
    <div id="activities" class="space-y-4"></div>

    <!-- Vision Statement Builder (Day 1 only) -->
    <div id="vision-builder" class="mt-8 bg-white rounded-2xl shadow-sm p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-4">Vision Statements Captured</h3>
      <div id="vision-list" class="space-y-3"></div>
      <button id="vision-add" type="button"
        class="mt-3 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
        + Add Vision Statement
      </button>
    </div>
  </div>

  <script>
    // ---------- State ----------
    const state = {
      currentDay: 1,
      expandedActivity: null,
      timerActive: false,
      timeRemaining: 0, // seconds
      timerInterval: null,
      completedActivities: new Set(),
      notes: {}, // { [id]: string }
      visionStatements: [] // [{ text:'', author:'' }]
    };

    // ---------- Data ----------
    const day1Activities = [
      {
        id: 1,
        title: "Quiz Card",
        duration: 20,
        description: "Get to know each other better with quiz cards",
        prep: [
          "Print quiz cards or prepare digital version",
          "Have a visible timer ready"
        ],
        details: [
          "Question 1: What was your first job?",
          "Question 2: A song that you enjoy from your childhood?",
          "Question 3: What is something you're proud of?"
        ],
        facilitation: [
          "Go around the room, each person shares one question at a time",
          "Keep energy high and encourage storytelling",
          "Time management: ~6-7 min per question"
        ]
      },
      {
        id: 2,
        title: "Personal Timeline",
        duration: 30,
        description: "Share highs and lows from the last year",
        prep: [
          "Prepare a timeline on the wall/board (Jan-Dec)",
          "Have sticky notes and pens ready for each person",
          "Different colored sticky notes for highs (green) and lows (red)"
        ],
        details: [
          "Grab a sticky note for your timeline",
          "Mark your highs and lows across the months",
          "Share with the team"
        ],
        facilitation: [
          "Give 5 min for individual reflection and writing",
          "Each person places their sticky notes on the timeline",
          "Share stories - 2-3 min per person",
          "Look for patterns across the team"
        ]
      },
      {
        id: 3,
        title: "Retrospective",
        duration: 60,
        description: "Reflect on the past year",
        prep: [
          "Create three sections on board/wall: 'I like', 'I wish', 'I wonder'",
          "Sticky notes (3 colors preferred) and pens for everyone",
          "Timer visible to all"
        ],
        details: [
          "I like... (What went well)",
          "I wish... (What could be improved)",
          "I wonder... (Questions for the future)"
        ],
        facilitation: [
          "Silent writing: 10 min - everyone writes sticky notes",
          "Posting: 5 min - place notes on board",
          "Grouping: 10 min - group similar themes together as a team",
          "Discussion: 30-35 min - discuss themes, starting with 'I like'",
          "Capture action items and insights in notes section"
        ]
      },
      {
        id: 4,
        title: "Product Vision",
        duration: 90,
        description: "Define the product vision and strategy",
        prep: [
          "Prepare your PO presentation (customer, problem, context)",
          "Large sheets/board space for vision work",
          "Sticky notes and markers",
          "Vision statement templates printed or visible"
        ],
        steps: [
          {
            step: 1,
            title: "Product Owner Shares Vision",
            items: ["Who is the customer", "What does IDC solve", "Additional strategic context"],
            facilitation: "Take 15-20 min to present. Be clear and inspiring. Allow questions."
          },
          {
            step: 2,
            title: "Create Shared Team Vision",
            prompt: "What is the ultimate impact our product should achieve for our users and stakeholders in the next 2-3 years?",
            activity: ["1-2-4-All", "1 Minute alone", "2 Minutes in pairs", "4 Group of 4", "All together"],
            facilitation: "Strictly time each phase. Encourage building on each other's ideas."
          },
          {
            step: 3,
            title: "Identify Recurring Themes",
            description: "What patterns emerge from our discussion?",
            facilitation: "Write themes on board. Look for: customer impact, team values, product differentiation."
          },
          {
            step: 4,
            title: "Draft Vision Statement",
            options: [
              "Option 1: We help [target user] achieve [benefit] by [how product creates value]",
              "Option 2: Our product will [impact] so that [greater purpose]"
            ],
            activity: ["In pairs (5-10 minutes)", "In the group (10 minutes)", "Use best of all and draft it together"],
            facilitation: "Keep it concise (1-2 sentences). Make it inspiring. Ensure buy-in from everyone."
          }
        ]
      },
      {
        id: 5,
        title: "Team Name",
        duration: 30,
        description: "Choose a team name",
        prep: [
          "Clear board space for brainstorming",
          "Markers or digital whiteboard ready"
        ],
        details: ["Brainstorm ideas", "Vote on favorites", "Decide together"],
        facilitation: [
          "Open brainstorm: 10 min - all ideas welcome",
          "Narrow down: 10 min - discuss top 5-7",
          "Vote: Use dot voting or consensus",
          "Make it fun and inclusive!"
        ]
      }
    ];

    const day2Activities = [
      {
        id: 6,
        title: "Retrospect Yesterday",
        duration: 20,
        description: "Reflect on Day 1 learnings",
        prep: [
          "Review your notes from Day 1",
          "Have sticky notes ready"
        ],
        details: [
          "What did you take from yesterday's session?",
          "What would you like to get out of today's session?"
        ],
        facilitation: [
          "Quick round robin - 2 min per person",
          "Capture themes on board",
          "Use this to adjust Day 2 if needed"
        ]
      },
      {
        id: 7,
        title: "Team Construction",
        duration: 60,
        description: "Create team agreements based on shared values",
        prep: [
          "Create 3 sections in room with labels: 'Common ground', 'Diverse needs', 'Surprises'",
          "Lots of sticky notes in different colors",
          "Large sheets for final agreements"
        ],
        reflection: {
          prompt: "To do my best work, I need...",
          categories: [
            "Communication: How or when do I need to be informed? What is my preferred communication style?",
            "Collaboration: What helps me work well with others? What disrupts my flow?",
            "Feedback: How do I want to receive feedback? How often?",
            "Support: When I'm stuck, what do I need?",
            "Boundaries: What are my non-negotiables? (meeting times, focus hours, response times)"
          ]
        },
        steps: [
          "Individual reflection (10 min) - write on sticky notes",
          "Discuss in groups of 3 or 4 (15 min)",
          "Find patterns: What came up multiple times? What are our shared values? (10 min)",
          "Determine main differences (5 min)",
          "Place sticky notes in room sections (5 min)",
          "Create 3-5 team agreements starting with 'We agree that...' (15 min)"
        ],
        facilitation: [
          "Encourage honesty and vulnerability",
          "Ensure all voices are heard",
          "Focus on actionable agreements",
          "Document agreements - take photo or write in notes"
        ]
      },
      {
        id: 8,
        title: "Event Optimizer",
        duration: 60,
        description: "Improve scrum events",
        prep: [
          "List of current scrum events visible",
          "Space for teams to work in groups of 2-3",
          "Paper/boards for each team"
        ],
        events: ["Daily", "Sprint Planning", "Refinement", "Retrospective"],
        details: [
          "In teams of two or three, choose one event",
          "Make 10 minute agenda per event and add improvements we can make",
          "Discuss and accept as team"
        ],
        facilitation: [
          "Divide team into 2-3 person groups",
          "Each group picks different event (or same if small team)",
          "Work time: 20-25 min",
          "Presentations: 5-7 min per group",
          "Team discussion & acceptance: 15-20 min",
          "Ask: What works? What concerns do we have? What will we try?"
        ]
      },
      {
        id: 9,
        title: "Definition of Done",
        duration: 60,
        description: "Define what 'done' means for the team",
        prep: [
          "Print or display DoD categories table",
          "Organize sticky notes by category (Code Quality, Testing, Documentation, etc.)",
          "Large board space for organizing notes",
          "Confluence or documentation tool open to capture final DoD"
        ],
        categories: ["Code Quality","Testing","Documentation","Security","Deployment/Release","Performance"],
        guidingQuestions: [
          "What feels outdated?",
          "What's missing that we always do anyway?",
          "What should we add to raise quality?"
        ],
        steps: [
          "Review current DoD and question (10 min): a) What feels outdated, b) What can make our work more mature, c) What can make our work of better quality, d) What can be improved on the previous DoD",
          "Which DoD categories do we need? (quick discussion)",
          "Discuss in teams of two (15 min)",
          "Share top 5 suggestions on board (5 min)",
          "Align and discuss (40 min): a) Order by theme, b) Vote, c) Rewrite and agree together on Confluence"
        ],
        facilitation: [
          "Start with current DoD review - be critical",
          "Encourage specific, measurable criteria",
          "Focus on quality, not just checkboxes",
          "Ensure DoD is realistic and achievable",
          "Get explicit agreement from everyone",
          "Remind: DoD should be living document, reviewed regularly"
        ]
      }
    ];

    const byId = (id) => document.getElementById(id);
    const getActivities = () => (state.currentDay === 1 ? day1Activities : day2Activities);

    // ---------- Timer ----------
    function formatTime(s) {
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return `${m}:${sec.toString().padStart(2, "0")}`;
    }

    function startTimer(minutes) {
      state.timeRemaining = minutes * 60;
      state.timerActive = true;
      ensureTimerRunning();
      renderTimer();
    }

    function ensureTimerRunning() {
      clearInterval(state.timerInterval);
      if (state.timerActive && state.timeRemaining > 0) {
        state.timerInterval = setInterval(() => {
          if (state.timeRemaining <= 1) {
            state.timeRemaining = 0;
            state.timerActive = false;
            clearInterval(state.timerInterval);
          } else {
            state.timeRemaining -= 1;
          }
          renderTimer();
        }, 1000);
      }
    }

    function toggleTimer() {
      state.timerActive = !state.timerActive;
      ensureTimerRunning();
      renderTimer();
    }

    function clearTimer() {
      state.timeRemaining = 0;
      state.timerActive = false;
      clearInterval(state.timerInterval);
      renderTimer();
    }

    function resetTimer(minutes) {
      state.timeRemaining = minutes * 60;
      state.timerActive = false;
      clearInterval(state.timerInterval);
      renderTimer();
    }

    function renderTimer() {
      const widget = byId('timer-widget');
      const display = byId('timer-display');
      const toggleBtn = byId('timer-toggle');

      if (state.timeRemaining > 0) {
        widget.classList.remove('hidden');
        display.textContent = formatTime(state.timeRemaining);
        display.classList.toggle('text-red-600', state.timeRemaining < 60);
        display.classList.toggle('text-purple-600', state.timeRemaining >= 60);

        toggleBtn.innerHTML = '';
        const iconName = state.timerActive ? 'pause' : 'play';
        const i = document.createElement('i');
        i.setAttribute('data-lucide', iconName);
        i.className = 'w-6 h-6 text-purple-600';
        toggleBtn.appendChild(i);
        lucide.createIcons();
      } else {
        widget.classList.add('hidden');
      }
    }

    // ---------- Progress ----------
    function renderProgress() {
      const current = getActivities();
      const count = current.filter(a => state.completedActivities.has(a.id)).length;
      const total = current.length;
      const pct = total ? (count / total) * 100 : 0;

      byId('progress-title').textContent = `Day ${state.currentDay} Progress`;
      byId('progress-count').textContent = `${count} / ${total} completed`;
      byId('progress-bar').style.width = `${pct}%`;
    }

    // ---------- Vision ----------
    function renderVision() {
      const wrapper = byId('vision-builder');
      if (state.currentDay !== 1) {
        wrapper.classList.add('hidden');
        return;
      }
      wrapper.classList.remove('hidden');

      const list = byId('vision-list');
      list.innerHTML = '';
      state.visionStatements.forEach((st, idx) => {
        const row = document.createElement('div');
        row.className = 'flex gap-3';
        row.innerHTML = `
          <input type="text" placeholder="Team member name..." value="${escapeHtml(st.author)}"
            class="w-40 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"
            data-vision-index="${idx}" data-field="author" />
          <input type="text" placeholder="Vision statement..." value="${escapeHtml(st.text)}"
            class="flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"
            data-vision-index="${idx}" data-field="text" />
        `;
        list.appendChild(row);
      });
    }

    function addVisionStatement() {
      state.visionStatements.push({ text: '', author: '' });
      renderVision();
    }

    function updateVisionStatement(index, field, value) {
      const i = Number(index);
      if (!Number.isNaN(i) && state.visionStatements[i]) {
        state.visionStatements[i][field] = value;
      }
    }

    // ---------- Activities ----------
    function renderActivities() {
      const container = byId('activities');
      const activities = getActivities();
      container.innerHTML = '';

      activities.forEach((activity, index) => {
        const isExpanded = state.expandedActivity === activity.id;
        const isCompleted = state.completedActivities.has(activity.id);

        const card = document.createElement('div');
        card.className = `bg-white rounded-2xl shadow-sm hover:shadow-md transition-all border-2 ${isCompleted ? 'border-green-300 bg-green-50' : 'border-transparent'}`;

        // Header
        const header = document.createElement('div');
        header.className = 'p-6 cursor-pointer';
        header.addEventListener('click', () => {
          state.expandedActivity = isExpanded ? null : activity.id;
          renderAll();
        });

        header.innerHTML = `
          <div class="flex items-start justify-between">
            <div class="flex items-start gap-4 flex-1">
              <div class="flex-shrink-0">
                <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center text-white font-bold text-lg">
                  ${index + 1}
                </div>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-3">
                  <h3 class="text-xl font-bold text-gray-900">${activity.title}</h3>
                  <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-medium flex items-center gap-1">
                    <i data-lucide="clock" class="w-4 h-4"></i>
                    ${activity.duration} min
                  </span>
                </div>
                <p class="text-gray-600 mt-1">${activity.description}</p>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <button type="button"
                class="p-2 rounded-lg transition-all ${isCompleted ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-400 hover:bg-gray-200'}"
                data-action="toggle-complete" data-id="${activity.id}">
                <i data-lucide="check" class="w-5 h-5"></i>
              </button>
              <i data-lucide="${isExpanded ? 'chevron-down' : 'chevron-right'}" class="w-6 h-6 text-gray-400"></i>
            </div>
          </div>
        `;
        card.appendChild(header);

        // Expanded content
        if (isExpanded) {
          const body = document.createElement('div');
          body.className = 'px-6 pb-6 space-y-4 border-t border-gray-100 pt-4';

          // Prep
          if (activity.prep) {
            const section = document.createElement('div');
            section.className = 'bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4';
            section.innerHTML = `
              <div class="flex items-center gap-2 mb-3">
                <i data-lucide="clipboard" class="w-5 h-5 text-blue-600"></i>
                <h4 class="font-bold text-blue-900">Preparation Checklist</h4>
              </div>
              <ul class="space-y-2">
                ${activity.prep.map(item => `
                  <li class="flex items-start gap-2 text-blue-900">
                    <span class="text-blue-600 mt-1">â–¡</span>
                    <span>${item}</span>
                  </li>`).join('')}
              </ul>
            `;
            body.appendChild(section);
          }

          // Timer controls
          {
            const section = document.createElement('div');
            section.className = 'flex gap-2';
            section.innerHTML = `
              <button type="button"
                class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2"
                data-action="start-timer" data-minutes="${activity.duration}">
                <i data-lucide="play" class="w-4 h-4"></i>
                Start Timer
              </button>
              <button type="button"
                class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2"
                data-action="reset-timer" data-minutes="${activity.duration}">
                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                Reset
              </button>
            `;
            body.appendChild(section);
          }

          // Reflection
          if (activity.reflection) {
            const section = document.createElement('div');
            section.className = 'bg-amber-50 rounded-lg p-4';
            section.innerHTML = `
              <h4 class="font-bold text-amber-900 mb-2">Reflection Prompt:</h4>
              <p class="text-amber-900 italic mb-3">"${activity.reflection.prompt}"</p>
              <div class="space-y-2">
                ${activity.reflection.categories.map(cat => `<p class="text-sm text-amber-800">â€¢ ${cat}</p>`).join('')}
              </div>
            `;
            body.appendChild(section);
          }

          // Details
          if (activity.details) {
            const section = document.createElement('div');
            section.className = 'bg-purple-50 rounded-lg p-4';
            section.innerHTML = `
              <h4 class="font-semibold text-gray-900 mb-2">Activity Details:</h4>
              <ul class="space-y-2">
                ${activity.details.map(d => `
                  <li class="flex items-start gap-2 text-gray-700">
                    <span class="text-purple-600 mt-1">â€¢</span>
                    <span>${d}</span>
                  </li>`).join('')}
              </ul>
            `;
            body.appendChild(section);
          }

          // Events
          if (activity.events) {
            const section = document.createElement('div');
            section.className = 'bg-purple-50 rounded-lg p-4';
            section.innerHTML = `
              <h4 class="font-semibold text-gray-900 mb-2">Scrum Events to Review:</h4>
              <ul class="space-y-1">
                ${activity.events.map(ev => `<li class="text-gray-700">â€¢ ${ev}</li>`).join('')}
              </ul>
            `;
            body.appendChild(section);
          }

          // Categories
          if (activity.categories) {
            const section = document.createElement('div');
            section.className = 'bg-purple-50 rounded-lg p-4';
            section.innerHTML = `
              <h4 class="font-semibold text-gray-900 mb-2">DoD Categories:</h4>
              <div class="grid grid-cols-2 gap-2">
                ${activity.categories.map(cat => `
                  <div class="bg-white rounded px-3 py-2 text-gray-700 text-sm">${cat}</div>`).join('')}
              </div>
            `;
            body.appendChild(section);
          }

          // Guiding Questions
          if (activity.guidingQuestions) {
            const section = document.createElement('div');
            section.className = 'bg-yellow-50 rounded-lg p-4';
            section.innerHTML = `
              <h4 class="font-semibold text-gray-900 mb-2">Ask the Team:</h4>
              <ul class="space-y-2">
                ${activity.guidingQuestions.map(q => `<li class="text-gray-700 italic">â€¢ ${q}</li>`).join('')}
              </ul>
            `;
            body.appendChild(section);
          }

          // Steps (simple)
          if (activity.steps && !activity.steps[0].step) {
            const section = document.createElement('div');
            section.className = 'bg-purple-50 rounded-lg p-4';
            section.innerHTML = `
              <h4 class="font-semibold text-gray-900 mb-2">Steps:</h4>
              <ol class="space-y-2">
                ${activity.steps.map((s, i) => `<li class="text-gray-700"><span class="font-medium">${i + 1}.</span> ${s}</li>`).join('')}
              </ol>
            `;
            body.appendChild(section);
          }

          // Steps (complex)
          if (activity.steps && activity.steps[0].step) {
            const wrapper = document.createElement('div');
            wrapper.className = 'space-y-4';
            activity.steps.forEach(step => {
              const s = document.createElement('div');
              s.className = 'bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4';
              s.innerHTML = `
                <div class="flex items-center gap-2 mb-3">
                  <span class="w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold text-sm">
                    ${step.step}
                  </span>
                  <h4 class="font-bold text-gray-900">${step.title}</h4>
                </div>
                ${step.items ? `<ul class="space-y-1 ml-10">${step.items.map(it => `<li class="text-gray-700">â€¢ ${it}</li>`).join('')}</ul>` : ''}
                ${step.prompt ? `<p class="ml-10 text-gray-700 italic">"${step.prompt}"</p>` : ''}
                ${step.activity ? `<div class="ml-10 mt-2 space-y-1">${step.activity.map(a => `<p class="text-gray-700">â†’ ${a}</p>`).join('')}</div>` : ''}
                ${step.description ? `<p class="ml-10 text-gray-700">${step.description}</p>` : ''}
                ${step.options ? `<div class="ml-10 mt-2 space-y-2">${step.options.map(op => `<div class="bg-white rounded-lg p-3"><p class="text-gray-800 font-medium">${op}</p></div>`).join('')}</div>` : ''}
                ${step.facilitation ? `
                  <div class="ml-10 mt-3 bg-green-50 rounded p-3">
                    <div class="flex items-center gap-2 mb-1">
                      <i data-lucide="lightbulb" class="w-4 h-4 text-green-600"></i>
                      <span class="text-sm font-semibold text-green-900">Facilitation Tip:</span>
                    </div>
                    <p class="text-sm text-green-800">${step.facilitation}</p>
                  </div>` : ''}
              `;
              wrapper.appendChild(s);
            });
            body.appendChild(wrapper);
          }

          // Facilitation tips
          if (activity.facilitation) {
            const section = document.createElement('div');
            section.className = 'bg-green-50 border-l-4 border-green-500 rounded-lg p-4';
            section.innerHTML = `
              <div class="flex items-center gap-2 mb-3">
                <i data-lucide="lightbulb" class="w-5 h-5 text-green-600"></i>
                <h4 class="font-bold text-green-900">Facilitation Tips</h4>
              </div>
              <ul class="space-y-2">
                ${activity.facilitation.map(t => `
                  <li class="flex items-start gap-2 text-green-900">
                    <span class="text-green-600 mt-1">â†’</span>
                    <span>${t}</span>
                  </li>`).join('')}
              </ul>
            `;
            body.appendChild(section);
          }

          // Notes
          {
            const section = document.createElement('div');
            section.innerHTML = `
              <label class="block text-sm font-medium text-gray-700 mb-2">Facilitator Notes & Insights:</label>
              <textarea
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"
                rows="4"
                data-action="update-notes" data-id="${activity.id}"
                placeholder="Capture key insights, themes, decisions, or action items...">${escapeHtml(state.notes[activity.id] || '')}</textarea>
            `;
            body.appendChild(section);
          }

          card.appendChild(body);
        }

        // Attach header button handlers (need to stop propagation)
        // We'll add after append to DOM
        container.appendChild(card);
      });

      // After render: wire up per-card buttons
      container.querySelectorAll('[data-action="toggle-complete"]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const id = Number(btn.getAttribute('data-id'));
          toggleComplete(id);
        });
      });

      container.querySelectorAll('[data-action="start-timer"]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const minutes = Number(btn.getAttribute('data-minutes'));
          startTimer(minutes);
        });
      });

      container.querySelectorAll('[data-action="reset-timer"]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const minutes = Number(btn.getAttribute('data-minutes'));
          resetTimer(minutes);
        });
      });

      container.querySelectorAll('[data-action="update-notes"]').forEach(textarea => {
        textarea.addEventListener('input', () => {
          const id = Number(textarea.getAttribute('data-id'));
          state.notes[id] = textarea.value;
        });
      });

      // Repaint icons
      lucide.createIcons();
    }

    function toggleComplete(id) {
      if (state.completedActivities.has(id)) state.completedActivities.delete(id);
      else state.completedActivities.add(id);
      renderAll();
    }

    // ---------- Helpers ----------
    function escapeHtml(str) {
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    // ---------- Master render ----------
    function renderAll() {
      // Header day buttons
      const btn1 = byId('btn-day-1');
      const btn2 = byId('btn-day-2');
      if (state.currentDay === 1) {
        btn1.className = 'px-6 py-2 rounded-lg font-medium transition-all bg-purple-600 text-white shadow-lg';
        btn2.className = 'px-6 py-2 rounded-lg font-medium transition-all bg-gray-100 text-gray-700 hover:bg-gray-200';
      } else {
        btn1.className = 'px-6 py-2 rounded-lg font-medium transition-all bg-gray-100 text-gray-700 hover:bg-gray-200';
        btn2.className = 'px-6 py-2 rounded-lg font-medium transition-all bg-purple-600 text-white shadow-lg';
      }

      renderActivities();
      renderProgress();
      renderVision();
      renderTimer();
    }

    // ---------- Init & Events ----------
    window.addEventListener('DOMContentLoaded', () => {
      // Day switches
      byId('btn-day-1').addEventListener('click', () => {
        state.currentDay = 1;
        state.expandedActivity = null;
        renderAll();
      });
      byId('btn-day-2').addEventListener('click', () => {
        state.currentDay = 2;
        state.expandedActivity = null;
        renderAll();
      });

      // Timer controls
      byId('timer-toggle').addEventListener('click', toggleTimer);
      byId('timer-clear').addEventListener('click', clearTimer);

      // Vision handlers
      byId('vision-add').addEventListener('click', addVisionStatement);
      byId('vision-list').addEventListener('input', (e) => {
        const t = e.target;
        const idx = t.getAttribute('data-vision-index');
        const field = t.getAttribute('data-field');
        if (idx !== null && field) {
          updateVisionStatement(idx, field, t.value);
        }
      });

      renderAll();
      lucide.createIcons();
    });
  </script>
</body>
</html>
